---
globs: src/routes/**/**.tsx,src/routes/**/**.ts
alwaysApply: false
---
ä»¥ä¸‹ã®æ§‹æˆã‚’è¸ã¾ãˆã¦ã€ViewModelãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¨­è¨ˆãƒ»å®Ÿè£…ã‚’å¼·åŒ–ã—ã€React hooksã®é©åˆ‡ãªä½¿ç”¨æ–¹æ³•ã‚’ææ¡ˆã—ã¾ã™ã€‚

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
ï¼ˆhogeã¯ãƒšãƒ¼ã‚¸ã”ã¨ã«åˆ†ã‹ã‚Œã¾ã™ï¼‰
* `src/routes/hoge/route.tsx` â€¦ ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆUIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å°‚ç”¨ï¼‰
* `src/routes/hoge/route.model.ts` â€¦ ViewModelã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆçŠ¶æ…‹ç®¡ç†ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
* `src/routes/hoge/-components/` ä»¥ä¸‹ â€¦ å½“è©²ãƒšãƒ¼ã‚¸å›ºæœ‰ã®å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
* `src/components/features/` ä»¥ä¸‹ â€¦ è¤‡æ•°ãƒšãƒ¼ã‚¸å…±é€šã®æ©Ÿèƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
* `src/components/ui/` ä»¥ä¸‹ â€¦ æ±ç”¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

---

## ViewModelãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å®Ÿè£…

### 1. **`route.model.ts` ã«ViewModelã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’å®Ÿè£…**

```ts
// src/routes/hoge/route.model.ts
import { useToast } from '@/components/ui/Toast';
import { client } from '@/lib/hono';
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { useNavigate } from '@tanstack/react-router';
import { useEffect, useState } from 'react';

/**
 * hogeãƒšãƒ¼ã‚¸ã®ViewModelã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
 * çŠ¶æ…‹ç®¡ç†ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’é›†ç´„
 */
export function useHogeViewModel(searchParams?: any) {
  // === ã™ã¹ã¦ã®ãƒ•ãƒƒã‚¯ã‚’æœ€åˆã«å‘¼ã³å‡ºã—ã€æ¡ä»¶ä»˜ãå‘¼ã³å‡ºã—ã‚’é¿ã‘ã‚‹ ===
  const apiClient = client.api;
  const { showToast } = useToast();
  const queryClient = useQueryClient();
  const navigate = useNavigate();

  // ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹
  const [formData, setFormData] = useState({});
  const [loading, setLoading] = useState(false);

  // ãƒ‡ãƒ¼ã‚¿ã‚¯ã‚¨ãƒª
  const dataQuery = useQuery({
    queryKey: ['hoge-data'],
    queryFn: async () => {
      const res = await apiClient.hoge.$get();
      return res.json();
    },
  });

  // ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  const updateMutation = useMutation({
    mutationFn: async (data: any) => {
      return await apiClient.hoge.$post({ json: data });
    },
    onSuccess: () => {
      showToast('æ›´æ–°ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
      queryClient.invalidateQueries({ queryKey: ['hoge-data'] });
    },
    onError: (error) => {
      showToast(`æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
    },
  });

  // åˆæœŸåŒ–å‡¦ç†
  useEffect(() => {
    // åˆæœŸåŒ–ãƒ­ã‚¸ãƒƒã‚¯
  }, []);

  // === ã“ã“ã‹ã‚‰éãƒ•ãƒƒã‚¯é–¢æ•°ã®å®šç¾© ===
  
  // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯é–¢æ•°
  const handleSubmit = async (data: any) => {
    setLoading(true);
    try {
      await updateMutation.mutateAsync(data);
    } finally {
      setLoading(false);
    }
  };

  const handleNavigation = (path: string) => {
    navigate({ to: path });
  };

  return {
    // çŠ¶æ…‹
    formData,
    loading,
    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    setFormData,
    handleSubmit,
    handleNavigation,
    // ã‚¯ã‚¨ãƒª
    dataQuery,
    // ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    updateMutation,
  };
}
```

### 2. **ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ViewModelã‚’ä½¿ç”¨**

```tsx
// src/routes/hoge/route.tsx
import { createFileRoute } from '@tanstack/react-router';
import { PageContainer, PageHeader } from '@/components/layout/PageHeader';
import { useHogeViewModel } from './route.model';
import { HogeForm } from './-components/HogeForm';

function HogePage() {
  const searchParams = Route.useSearch();
  const {
    formData,
    loading,
    setFormData,
    handleSubmit,
    dataQuery,
    updateMutation,
  } = useHogeViewModel(searchParams);

  return (
    <PageContainer>
      <PageHeader title="Hogeãƒšãƒ¼ã‚¸" />
      
      <HogeForm
        data={formData}
        loading={loading}
        onSubmit={handleSubmit}
        onChange={setFormData}
      />
    </PageContainer>
  );
}

export const Route = createFileRoute('/hoge')({
  component: HogePage,
});
```

### 3. **ãƒšãƒ¼ã‚¸å›ºæœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ç´”ç²‹ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«**

```tsx
// src/routes/hoge/-components/HogeForm.tsx
interface HogeFormProps {
  data: any;
  loading: boolean;
  onSubmit: (data: any) => void;
  onChange: (data: any) => void;
}

export const HogeForm: React.FC<HogeFormProps> = ({
  data,
  loading,
  onSubmit,
  onChange,
}) => {
  // UIãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯æŒãŸãªã„
  return (
    <form onSubmit={onSubmit}>
      {/* ãƒ•ã‚©ãƒ¼ãƒ å†…å®¹ */}
    </form>
  );
};
```

---

## React Hooksã®é©åˆ‡ãªä½¿ç”¨æ–¹æ³•

### 1. **ãƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—ã®é †åºå³å®ˆ**

```ts
export function useViewModel() {
  // âœ… æ­£ã—ã„ï¼šã™ã¹ã¦ã®ãƒ•ãƒƒã‚¯ã‚’æœ€åˆã«å‘¼ã³å‡ºã—
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const [state, setState] = useState();
  
  const query = useQuery({...});
  const mutation = useMutation({...});
  
  useEffect(() => {...}, []);
  
  // âœ… æ­£ã—ã„ï¼šéãƒ•ãƒƒã‚¯é–¢æ•°ã¯æœ€å¾Œã«å®šç¾©
  const handleSomething = () => {
    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
  };
  
  return { state, handleSomething, query, mutation };
}
```

### 2. **é¿ã‘ã‚‹ã¹ãã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**

```ts
// âŒ é–“é•ã„ï¼šæ¡ä»¶ä»˜ããƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—
export function useViewModel() {
  if (condition) {
    const query = useQuery({...}); // ã“ã‚Œã¯NG
  }
  
  // âŒ é–“é•ã„ï¼šãƒ«ãƒ¼ãƒ—å†…ã§ã®ãƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—
  for (let i = 0; i < items.length; i++) {
    useState(); // ã“ã‚Œã¯NG
  }
  
  // âŒ é–“é•ã„ï¼šã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã®ãƒ•ãƒƒã‚¯å‘¼ã³å‡ºã—
  class ViewModel {
    getData() {
      return useQuery({...}); // ã“ã‚Œã¯NG
    }
  }
}
```

---

## ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã®é…ç½®ãƒ«ãƒ¼ãƒ«

### 1. **TanStack Routerã¨ã®è¦ªå’Œæ€§**

```
src/routes/
â”œâ”€â”€ index/
â”‚   â”œâ”€â”€ route.tsx          # / ãƒ‘ã‚¹
â”‚   â”œâ”€â”€ route.model.ts     # ViewModelã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â””â”€â”€ -components/       # ãƒšãƒ¼ã‚¸å›ºæœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ route.tsx          # /dashboard ãƒ‘ã‚¹
â”‚   â”œâ”€â”€ route.model.ts
â”‚   â””â”€â”€ -components/
â””â”€â”€ $id/                   # å‹•çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    â”œâ”€â”€ route.tsx          # /:id ãƒ‘ã‚¹
    â”œâ”€â”€ route.model.ts
    â”œâ”€â”€ -components/
    â””â”€â”€ voices/
        â”œâ”€â”€ route.tsx      # /:id/voices ãƒ‘ã‚¹
        â””â”€â”€ route.model.ts
```

### 2. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…ç½®æˆ¦ç•¥**

* **ãƒšãƒ¼ã‚¸å›ºæœ‰ã®UI**: `src/routes/hoge/-components/`
* **è¤‡æ•°ãƒšãƒ¼ã‚¸å…±é€šã®æ©Ÿèƒ½**: `src/components/features/`
* **æ±ç”¨UIéƒ¨å“**: `src/components/ui/`

---

## å¼·åŒ–ãƒã‚¤ãƒ³ãƒˆï¼šå†åˆ©ç”¨å¯èƒ½ãªViewModelãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. **å…±é€šã®ViewModelãƒ™ãƒ¼ã‚¹**

```ts
// src/hooks/useBaseViewModel.ts
export function useBaseViewModel() {
  const { showToast } = useToast();
  const queryClient = useQueryClient();
  const navigate = useNavigate();

  const handleSuccess = (message: string) => {
    showToast(message, 'success');
    queryClient.invalidateQueries();
  };

  const handleError = (error: Error) => {
    showToast(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
  };

  return {
    showToast,
    queryClient,
    navigate,
    handleSuccess,
    handleError,
  };
}

// å„ãƒšãƒ¼ã‚¸ã®ViewModelã§ç¶™æ‰¿
export function useHogeViewModel() {
  const base = useBaseViewModel();
  
  // ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯
  const specificLogic = () => {
    // å®Ÿè£…
  };

  return {
    ...base,
    specificLogic,
  };
}
```

### 2. **å‹å®‰å…¨ãªViewModelã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**

```ts
// src/types/viewModel.ts
export interface BaseViewModel {
  loading: boolean;
  error: string | null;
  handleSuccess: (message: string) => void;
  handleError: (error: Error) => void;
}

export interface HogeViewModel extends BaseViewModel {
  formData: HogeFormData;
  handleSubmit: (data: HogeFormData) => Promise<void>;
  handleNavigation: (path: string) => void;
}
```

---

## å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹

### 1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**

```ts
// useCallbackã‚’é©åˆ‡ã«ä½¿ç”¨
const handleSubmit = useCallback(async (data: any) => {
  // å‡¦ç†
}, [dependency]);

// useMemoã§ã®è¨ˆç®—ã‚­ãƒ£ãƒƒã‚·ãƒ¥
const expensiveValue = useMemo(() => {
  return heavyCalculation(data);
}, [data]);
```

### 2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€**

```ts
export function useViewModel() {
  const mutation = useMutation({
    mutationFn: async (data) => {
      try {
        return await apiCall(data);
      } catch (error) {
        console.error('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', error);
        throw error;
      }
    },
    onError: (error) => {
      // çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      showToast(`å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
    },
  });

  return { mutation };
}
```

---

## ã¾ã¨ã‚

| æ¦‚å¿µ | é…ç½®å…ˆ | å½¹å‰² |
|------|--------|------|
| ViewModelã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ | `src/routes/hoge/route.model.ts` | çŠ¶æ…‹ç®¡ç†ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ |
| ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | `src/routes/hoge/route.tsx` | UIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å°‚ç”¨ |
| ãƒšãƒ¼ã‚¸å›ºæœ‰UI | `src/routes/hoge/-components/` | ç´”ç²‹ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| å…±é€šæ©Ÿèƒ½ | `src/components/features/` | è¤‡æ•°ãƒšãƒ¼ã‚¸ã§ä½¿ç”¨ã™ã‚‹æ©Ÿèƒ½ |
| æ±ç”¨UI | `src/components/ui/` | åŸºæœ¬çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |

ã“ã®æ§‹æˆã«ã‚ˆã‚Šã€ViewModelãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢ã€React hooksã®é©åˆ‡ãªä½¿ç”¨ã€å‹å®‰å…¨æ€§ã®ç¢ºä¿ã€å†åˆ©ç”¨æ€§ã®å‘ä¸Šã€TanStack Routerã¨ã®è‡ªç„¶ãªçµ±åˆã‚’å®Ÿç¾ã§ãã¾ã™ã€‚
